---
title: "hb-data-vis"
author: "Sarah Supp"
date: "October 4, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Getting set up:

```{r, echo=FALSE}
library(dplyr)
library(ggplot2)
library(ggmap)
library(gganimate)
library(lubridate)
library(plyr)
library(plotly)
dropbox <- "/home/sarah/Dropbox/Hummingbirds/"
github <- "/home/sarah/Documents/GitHub/hb-migration/"

#assign based on the time frame (number of days) used to compute the alpha hulls
alpha_window = 5

# define pathnames (FAL will need to change pathnames)
function.dir <- paste0(github, "hb_RS_functions.R")
agan.dir <- paste0(dropbox, "hb_migration_data/ebird_annotated_raw/combined/")
abs.dir <- paste0(dropbox, "hb_migration_data/pseudoabsences/t", alpha_window, "/annotated/")
migtime.dir <- paste0(dropbox, "hb_migration_data/ebird_raw/eBird_checklists_2008-2014/aggregate_by_species/")
fig.dir <- paste0(dropbox, "NASA_Hummingbirds/P10_eBird_Migration_multiple topics/2-Mechanisms/figures/")
stat.dir <- paste0(dropbox, "NASA_Hummingbirds/P10_eBird_Migration_multiple topics/2-Mechanisms/stat-tests/")

source(function.dir) 

#list of species codes
species <- c("bchu", "bthu", "cahu", "ruhu", "rthu")
```


## broad-tailed hummingbird

```{r, echo=FALSE}
sp = "bthu"

  spfiles = list.files(path = agan.dir, pattern = glob2rx(paste0(sp,"*.RData")), recursive=FALSE, full.names=TRUE)
  pls.abs = list.files(path = abs.dir, pattern = glob2rx(paste0(sp,"*goingto.rda")), recursive=FALSE, full.names=TRUE)
  min.abs = list.files(path = abs.dir, pattern = glob2rx(paste0(sp,"*comingfrom.rda")), recursive=FALSE, full.names=TRUE)
  mfiles = list.files(path = migtime.dir, pattern = glob2rx(paste0(sp,"*migration*")), recursive=FALSE, full.names=TRUE)
  
  #import migration dates from previous analysis
  if(sp == "rthu"){ migdates = read.table(mfiles[1], header=TRUE, sep=",", quote="", fill=TRUE, as.is=TRUE, comment.char="")}
  if(sp %in% c("bchu", "bthu", "cahu", "ruhu")){ migdates = read.table(mfiles[2], header=TRUE, sep=",", quote="", fill=TRUE, as.is=TRUE, comment.char="")}
  migdates=cleanColNames(migdates)
  
  #load all the files into a list and remove rows with incomplete predictors
  abs = importANDformat(spfiles[1], 0, migdates, alpha_window)
  abs <- abs[which(complete.cases(subset(abs, select = -yday1))),]
  pres = importANDformat(spfiles[2], 1, migdates, alpha_window)
  pres <- pres[which(complete.cases(subset(pres, select = -yday1))),]
  min.abs = get(load(min.abs))
  min.abs = min.abs[which(complete.cases(min.abs)),]
  pls.abs = get(load(pls.abs))
  pls.abs = pls.abs[which(complete.cases(pls.abs)),]
  print (paste0("Imported data for species: ", sp))
  
  #subset data for models - note that models will be run forward and backwards within a season
  pa = subset(rbind(pres, abs), season %in% c("spring", "breeding", "fall"))
  pmin = subset(rbind(pres, min.abs), season %in% c("spring", "breeding", "fall"))
  ppls = subset(rbind(pres, pls.abs), season %in% c("spring", "breeding", "fall"))
  
  pa.spring = subset(rbind(pres, abs), season=="spring")
  pmin.spring = subset(rbind(pres, min.abs), season=="spring")
  ppls.spring = subset(rbind(pres, pls.abs), season=="spring")
  
  pa.fall = subset(rbind(pres, abs), season=="fall")
  pmin.fall = subset(rbind(pres, min.abs), season=="fall")
  ppls.fall = subset(rbind(pres, pls.abs), season=="fall")
  
  # presence data to use for plots
  spr_fal = pres[pres$season=="spring" | pres$season=="fall",]
```

###Print summary information on number of data points for each dataset
```{r, echo=FALSE}
print(sp)
print(paste0("Number occurrences: ", nrow(pres)))
print(paste0("Number within-region absences from complete checklists: ", nrow(abs)))  
print(paste0("Number absences for backward trajectory (past locations): ", nrow(min.abs))) 
print(paste0("Number absences for forward trajectory (future locations): ", nrow(pls.abs))) 
      
print(paste0("Number spr/fall occurrences: ", nrow(spr_fal)))
print(paste0("Number spr/fall within-region absences: ", nrow(abs[abs$season=="spring" | abs$season=="fall",]))) 
print(paste0("Number spr/fall backward trajectory (past locations): ", nrow(min.abs[min.abs$season=="spring" | min.abs$season=="fall",]))) 
print(paste0("Number spr/fall forward trajectory (future locations): ", nrow(pls.abs[pls.abs$season=="spring" | pls.abs$season=="fall",])))
```

###Environment distribution by season
####EVI
```{r, echo=FALSE}
sm=round(mean(spr_fal[spr_fal$season=="spring",]$EVI,),2)
ssd=round(sd(spr_fal[spr_fal$season=="spring",]$EVI,),2)
fm=round(mean(spr_fal[spr_fal$season=="fall",]$EVI,),2)
fsd=round(sd(spr_fal[spr_fal$season=="fall",]$EVI,),2)
ggplot(spr_fal, aes(EVI)) + geom_density(aes(fill=season), alpha=0.50) + ggtitle(paste0("spr (",sm,", ",ssd,") aut (",fm,", ",fsd,")"))
print(paste0("The 95 percentiles are: ", quantile(spr_fal$EVI, 0.05, 0.95)))
```

####Temperature
```{r, echo=FALSE}
sm=round(mean(spr_fal[spr_fal$season=="spring",]$t10m-273.15,),2)
ssd=round(sd(spr_fal[spr_fal$season=="spring",]$t10m-273.15,),2)
fm=round(mean(spr_fal[spr_fal$season=="fall",]$t10m-273.15,),2)
fsd=round(sd(spr_fal[spr_fal$season=="fall",]$t10m-273.15,),2)
ggplot(spr_fal, aes(t10m-273.15)) + geom_density(aes(fill=season), alpha=0.50) + ggtitle(paste0("spr (",sm,", ",ssd,") aut (",fm,", ",fsd,")")) + xlab("Celsius")
print(paste0("The 95 percentiles are: ", quantile(spr_fal$t10m, 0.05, 0.95)))
```

####Elevation
```{r, echo=FALSE}
sm=round(mean(spr_fal[spr_fal$season=="spring",]$SRTM_elev,),2)
ssd=round(sd(spr_fal[spr_fal$season=="spring",]$SRTM_elev,),2)
fm=round(mean(spr_fal[spr_fal$season=="fall",]$SRTM_elev,),2)
fsd=round(sd(spr_fal[spr_fal$season=="fall",]$SRTM_elev,),2)
ggplot(spr_fal, aes(SRTM_elev)) + geom_density(aes(fill=season), alpha=0.50) + ggtitle(paste0("spr (",sm,", ",ssd,") aut (",fm,", ",fsd,")")) + xlab("Elevation (m)")
print(paste0("The 95 percentiles are: ", quantile(spr_fal$SRTM_elev, 0.05, 0.95)))
```

Environment by day (black points are environmental conditions at forward and backward migration locations)
```{r, echo=FALSE}
ggplot(pres, aes(yday, EVI)) + geom_point(data=min.abs, alpha=0.10) + geom_point(data=pls.abs, alpha=0.10) + 
  geom_point(alpha=0.10, aes(col=season)) + ggtitle(sp) +
  stat_smooth(data=pres, method="gam", formula = y~s(x, k=10), col="black") + 
  geom_vline(data=migdates, aes(xintercept=peak_lat))

ggplot(pres, aes(yday, t10m-273.15)) + geom_point(data=min.abs, alpha=0.10) + geom_point(data=pls.abs, alpha=0.10) + 
  geom_point(alpha=0.10, aes(col=season)) + ggtitle(sp) + ylab("Temperature at 10 m (C)") +
  stat_smooth(data=pres, method="gam", formula = y~s(x, k=10), col="black") + 
  geom_vline(data=migdates, aes(xintercept=peak_lat))

ggplot(pres, aes(yday, SRTM_elev)) + geom_point(data=min.abs, alpha=0.10) + geom_point(data=pls.abs, alpha=0.10) + 
  geom_point(alpha=0.10, aes(col=season)) + ggtitle(sp) + ylab("Elevation (m)") +
  stat_smooth(data=pres, method="gam", formula = y~s(x, k=10), col="black") + 
  geom_vline(data=migdates, aes(xintercept=peak_lat))
```

Correlation of environmental variables, using all the presence and absence data
```{r, echo=FALSE}
spr_fal_abs=abs[abs$season=="spring" | abs$season=="fall",]
spr_fal_min=min.abs[min.abs$season=="spring" | min.abs$season=="fall",]
spr_fal_pls=pls.abs[pls.abs$season=="spring" | pls.abs$season=="fall",]
spr_fal_cor = rbind(spr_fal_abs, spr_fal_min, spr_fal_pls)
spr_fal_cor$season="X"
spr_fal_cor = rbind(spr_fal_cor, spr_fal)

cor=cor(scale(spr_fal_cor$SRTM_elev), scale(spr_fal_cor$t10m))
ggplot(spr_fal_cor, aes(scale(t10m), scale(SRTM_elev))) + geom_point(alpha=0.10, aes(col=season)) + ggtitle(paste0("Pearson Correlation = ", round(cor,2))) + 
  xlab("scaled Temperature") + ylab("scaled Elevation")

cor=cor(scale(spr_fal_cor$SRTM_elev), scale(spr_fal_cor$EVI))
ggplot(spr_fal_cor, aes(scale(EVI), scale(SRTM_elev))) + geom_point(alpha=0.10, aes(col=season)) + ggtitle(paste0("Pearson Correlation = ", round(cor,2))) + 
  xlab("scaled EVI") + ylab("scaled Elevation")

cor=cor(scale(spr_fal_cor$t10m), scale(spr_fal_cor$EVI))
ggplot(spr_fal_cor, aes(scale(EVI), scale(t10m))) + geom_point(alpha=0.10, aes(col=season)) + ggtitle(paste0("Pearson Correlation = ", round(cor,2))) + 
  xlab("scaled EVI") + ylab("scaled Temperature")

print(dim(spr_fal_cor))

print("For all the data (presence + abs): ")
print(paste0("mean EVI is ", round(mean(spr_fal_cor$EVI),2)))
print(paste0("sd EVI is ", sd(spr_fal_cor$EVI,2)))
print(paste0("The 95 percentiles of EVI are: ", quantile(spr_fal_cor$EVI, c(0.05, 0.95))))

print(paste0("mean temp is ", round(mean(spr_fal_cor$t10m),2)))
print(paste0("sd temp is ", sd(spr_fal_cor$t10m,2)))
print(paste0("The 95 percentiles of temp are: ", quantile(spr_fal_cor$t10m, c(0.05, 0.95))))

print(paste0("mean elevation is ", round(mean(spr_fal_cor$SRTM_elev),2)))
print(paste0("sd elevation is ", sd(spr_fal_cor$SRTM_elev,2)))
print(paste0("The 95 percentiles of elevation are: ", quantile(spr_fal_cor$SRTM_elev, c(0.05, 0.95))))
```

# distribution of environmental data by season, separately
```{r, echo=FALSE}

spr_all = rbind(subset(pres, season=="spring"), subset(abs, season=="spring"), subset(min.abs, season=="spring"), subset(pls.abs, season=="spring"))

fall_all = rbind(subset(pres, season=="fall"), subset(abs, season=="fall"), subset(min.abs, season=="fall"), subset(pls.abs, season=="fall"))

print("SPRING")
print(paste0("EVI mean: ", round(mean(spr_all$EVI),2), " sd: ", round(sd(spr_all$EVI),2), " 95 %iles: ", quantile(spr_all$EVI, c(0.05, 0.95))))
print(paste0("temp mean: ", round(mean(spr_all$t10m),2), " sd: ", round(sd(spr_all$t10m),2), " 95 %iles: ", quantile(spr_all$t10m, c(0.05, 0.95))))
print(paste0("elevation mean: ", round(mean(spr_all$SRTM_elev) ,2), " sd: ", round(sd(spr_all$SRTM_elev),2), " 95 %iles: ", quantile(spr_all$SRTM_elev, c(0.05, 0.95))))

print("AUTUMN")
print(paste0("EVI mean: ", round(mean(fall_all$EVI),2), " sd: ", round(sd(fall_all$EVI),2), " 95 %iles: ", quantile(fall_all$EVI, c(0.05, 0.95))))
print(paste0("temp mean: ", round(mean(fall_all$t10m),2), " sd: ", round(sd(fall_all$t10m),2), " 95 %iles: ", quantile(fall_all$t10m, c(0.05, 0.95))))
print(paste0("elevation mean: ", round(mean(fall_all$SRTM_elev),2), " sd: ", round(sd(fall_all$SRTM_elev),2), " 95 %iles: ", quantile(fall_all$SRTM_elev, c(0.05, 0.95))))

```

example of within-area presence, in the middle of 2014 spring migration (February 24-28)
```{r, echo=FALSE}
if(sp == "rthu"){myLocation = c(-105, 30, -60, 50)}
if(sp %in% c("bchu", "bthu", "cahu", "ruhu")){ myLocation = c(-130, 30, -105, 50)}

myMap = get_map(location=myLocation, source="stamen", maptype="watercolor", crop=FALSE)

spr_example = pa.spring[pa.spring$year==2014 & pa.spring$window==8,]
ggmap(myMap) + geom_point(data=spr_example, aes(x=location.long, y=location.lat, col=pres))

spr_mig_b = pmin.spring[pmin.spring$year==2014 & pmin.spring$window==8,]
ggmap(myMap) + geom_point(data=spr_mig_b, aes(x=location.long, y=location.lat, col=pres))

spr_mig_f = ppls.spring[ppls.spring$year==2014 & ppls.spring$window==8,]
ggmap(myMap) + geom_point(data=spr_mig_f, aes(x=location.long, y=location.lat, col=SRTM_elev))
```

Example of an animated map, for 2014, colored by temperature
```{r, echo=FALSE}

spr_fal_14 = spr_fal[spr_fal$year == 2014,]
myMap = get_map(location=myLocation, source="stamen", maptype="watercolor", crop=FALSE)

mp = ggmap(myMap) + geom_point(data=spr_fal, aes(x=location.long, y=location.lat, frame=window, col=t10m-273.15)) + 
  scale_color_gradient(low="blue", high="firebrick") 
gg_animate(mp)
#gg_animate(mp, paste0(fig.dir,"ruhu-2014.gif"))

# mp = ggmap(myMap) + geom_point(data=spr_fal, aes(x=location.long, y=location.lat, frame=window, col=EVI)) + scale_color_gradient(low="moccasin", high="chartreuse4")
#gg_animate(mp, paste0(fig.dir,"ruhu-2014-EVI.gif"))
```


Map all hummingbirds in all years and animate all hummingbirds migrating in 2014
```{r}
species <- c("bchu", "bthu", "cahu", "ruhu", "rthu")
all = NA
allabs = NA
allmin = NA
allpls = NA

for (sp in species){ 
  spfiles = list.files(path = agan.dir, pattern = glob2rx(paste0(sp,"*.RData")), recursive=FALSE, full.names=TRUE)
  mfiles = list.files(path = migtime.dir, pattern = glob2rx(paste0(sp,"*migration*")), recursive=FALSE, full.names=TRUE)
  pls.abs = list.files(path = abs.dir, pattern = glob2rx(paste0(sp,"*goingto.rda")), recursive=FALSE, full.names=TRUE)
  min.abs = list.files(path = abs.dir, pattern = glob2rx(paste0(sp,"*comingfrom.rda")), recursive=FALSE, full.names=TRUE)
 
  if(sp == "rthu"){ 
    migdates = read.table(mfiles[1], header=TRUE, sep=",", quote="", 
                         fill=TRUE, as.is=TRUE, comment.char="")}
  if(sp %in% c("bchu", "bthu", "cahu", "ruhu")){ 
     migdates = read.table(mfiles[2], header=TRUE, sep=",", quote="", 
                         fill=TRUE, as.is=TRUE, comment.char="")}
  migdates=cleanColNames(migdates)
   #load all the files into a list and remove rows with incomplete predictors
  pres = importANDformat(spfiles[2], 1, migdates, alpha_window)
  pres <- pres[which(complete.cases(subset(pres, select = -yday1))),]
  abs = importANDformat(spfiles[1], 0, migdates, alpha_window)
  abs <- abs[which(complete.cases(subset(abs, select = -yday1))),]
  min.abs = get(load(min.abs))
  min.abs = min.abs[which(complete.cases(min.abs)),]
  pls.abs = get(load(pls.abs))
  pls.abs = pls.abs[which(complete.cases(pls.abs)),]
  
  pres$sp = sp
  abs$sp = sp
  min.abs$sp = sp
  pls.abs$sp = sp
  
  all = rbind(all, pres)
  allabs = rbind(allabs, abs)
  allmin = rbind(allmin, min.abs)
  allpls = rbind(allpls, pls.abs)
}
all = all[-1,]
allabs = allabs[-1,]
allmin = allmin[-1,]
allpls = allpls[-1,]

all_spring = all[all$season=="spring",]
all_fall = all[all$season=="fall",]
all_breed = all[all$season=="breeding",]

myLocation = c(-130, 30, -60, 50)
myMap = get_map(location=myLocation, source="stamen", maptype="toner", crop=FALSE)

springmap = ggmap(myMap) + geom_point(data=all_spring, aes(x=location.long, y=location.lat, col=sp), alpha=0.25)
springmap

fallmap = ggmap(myMap) + geom_point(data=all_fall, aes(x=location.long, y=location.lat, col=sp), alpha=0.25)
fallmap

breedmap = ggmap(myMap) + geom_point(data=all_breed, aes(x=location.long, y=location.lat, col=sp))+ theme(legend.position ="bottom")
breedmap

all_14 = all[all$year==2014,]
myLocation = c(-130, 30, -60, 50)
myMap = get_map(location=myLocation, source="stamen", maptype="watercolor", crop=FALSE)

mp = ggmap(myMap) + geom_point(data=all_14, aes(x=location.long, y=location.lat, frame=month, col=sp), alpha=0.5)
gg_animate(mp)

```

Map convex hulls of daily points for a season
```{r}
ruhu_hull = all_spring[all_spring$sp=="ruhu" & all_spring$year==2013,]

myLocation = c(-130, 30, -103, 50)
myWesternMap = get_map(location=myLocation, source="stamen", maptype="toner", crop=FALSE)

chulls <- ddply(ruhu_hull, .(yday1), function(df) df[chull(df$location.long, df$location.lat), ])
ggmap(myWesternMap) + geom_polygon(data=chulls, aes(x=location.long, y=location.lat, group=yday1, col=month), fill=NA, alpha=0.2) + facet_wrap(~month) +
  scale_colour_brewer(palette = "Set1") + 
  scale_fill_brewer(palette = "Set1")

```

Plot difference of environment from mean occurrence values
```{r}

all_means <- all %>%
  filter(season %in% c("spring", "fall")) %>%
  select(year, yday1, season, EVI, SRTM_elev, t10m, sp) %>%
  group_by(sp, year, season, yday1) %>% 
  summarise_all(.funs = mean) 

all_sd <- all %>%
  filter(season %in% c("spring", "fall")) %>%
  select(year, yday1, season, EVI, SRTM_elev, t10m, sp) %>%
  group_by(sp, year, season, yday1) %>% 
  summarise_all(.funs = sd)

year = unique(all_means$year)
zdiffs = data.frame()

for (s in species){
  for (y in year) { 
    z_abs <- allabs %>%
      filter(season %in% c("spring", "fall")) %>%
      filter(sp == s & year == y) %>%
      select(yday1, EVI, SRTM_elev, t10m) 
      
    z_min <- allmin %>%
      filter(season %in% c("spring", "fall")) %>%
      filter(sp == s & year == y) %>%
      select(yday1, EVI, SRTM_elev, t10m) 
      
    z_pls <- allpls %>%
      filter(season %in% c("spring", "fall")) %>%
      filter(sp == s & year == y) %>%
      select(yday1, EVI, SRTM_elev, t10m) 
      
    zday = data.frame()
    
    for (d in unique(z_abs$yday1)) {
      # find the mean and sd of the occurrence data for the temporal window of species and year
      mean = all_means[all_means$sp==s & all_means$year==y & all_means$yday1==d, ]
      sd = all_sd[all_sd$sp==s & all_sd$year==y & all_sd$yday1==d, ]
      
      #in case there is a mismatch in yday1 between the pres and abs data
      if(nrow(mean) <1) {
        print(paste0("yday1 ", d, " is not in occurrence data for ", s, " ", y))
        next}
      
      #standardize (z-values) the data for that temporal window by the occurrence data
      za = z_abs %>%
        filter(yday1 == d) %>%
        mutate(zEVI = (EVI - mean$EVI)/sd$EVI,
               zSRTM = (SRTM_elev - mean$SRTM_elev)/sd$SRTM_elev,
               zt10m = (t10m - mean$t10m)/sd$t10m,
               type="local")
      
      zm = z_min %>%
        filter(yday1 == d) %>%
        mutate(zEVI = (EVI - mean$EVI)/sd$EVI,
               zSRTM = (SRTM_elev - mean$SRTM_elev)/sd$SRTM_elev,
               zt10m = (t10m - mean$t10m)/sd$t10m, 
               type="backward")
      
      zp = z_pls %>%
        filter(yday1 == d) %>%
        mutate(zEVI = (EVI - mean$EVI)/sd$EVI,
               zSRTM = (SRTM_elev - mean$SRTM_elev)/sd$SRTM_elev,
               zt10m = (t10m - mean$t10m)/sd$t10m,
               type="forward")
      
      zday = bind_rows(zday, za, zm, zp)
    }
  zday$sp = s
  zday$year = y
  
  zdiffs = bind_rows(zdiffs, zday)
  }
}

ggplot(zdiffs, aes(yday1, zEVI, group=interaction(year))) + stat_smooth(aes(fill=year, col=year)) + facet_wrap(~sp + type, ncol=3) + scale_y_continuous(limits=c(-2,2)) + geom_hline(yintercept=0) + theme(legend.position="bottom") 

ggplot(zdiffs, aes(yday1, zSRTM, group=interaction(year))) + stat_smooth(aes(fill=year, col=year)) + facet_wrap(~sp + type, ncol=3) + scale_y_continuous(limits=c(-2,2)) + geom_hline(yintercept=0) + theme(legend.position="bottom")

ggplot(zdiffs, aes(yday1, zt10m, group=interaction(year))) + stat_smooth(aes(fill=year, col=year)) + facet_wrap(~sp + type, ncol=3) + scale_y_continuous(limits=c(-2,2)) + geom_hline(yintercept=0) + theme(legend.position="bottom")
```

#plot environmental values for an example window and its absence comparison
```{r}
ruhu_2013_94<- all %>%
  filter(sp=="ruhu", year==2013, yday1==94)

ruhu_2013_94_abs <- allabs %>%
  filter(sp=="ruhu", year==2013, yday1==94)

ruhu_2013_94_min <- allmin %>%
  filter(sp=="ruhu", year==2013, yday==94)

ruhu_2013_94_pls <- allpls %>%
  filter(sp=="ruhu", year==2013, yday1==94)

p <- plot_ly(ruhu_2013_94, x = ~EVI, y = ~t10m, z = ~SRTM_elev, color=~location.lat) %>%
  add_markers() %>%
  layout(scene = list(xaxis = list(title = 'EVI'),
                     yaxis = list(title = 'Temperature'),
                     zaxis = list(title = 'Elevation')))

pabs <- plot_ly(ruhu_2013_94_abs, x = ~EVI, y = ~t10m, z = ~SRTM_elev, color=~location.lat) %>%
  add_markers() %>%
  layout(scene = list(xaxis = list(title = 'EVI'),
                     yaxis = list(title = 'Temperature'),
                     zaxis = list(title = 'Elevation')))

pmin <- plot_ly(ruhu_2013_94_min, x = ~EVI, y = ~t10m, z = ~SRTM_elev, color=~location.lat) %>%
  add_markers() %>%
  layout(scene = list(xaxis = list(title = 'EVI'),
                     yaxis = list(title = 'Temperature'),
                     zaxis = list(title = 'Elevation')))

ppls <- plot_ly(ruhu_2013_94_pls, x = ~EVI, y = ~t10m, z = ~SRTM_elev, color=~location.lat) %>%
  add_markers() %>%
  layout(scene = list(xaxis = list(title = 'EVI'),
                     yaxis = list(title = 'Temperature'),
                     zaxis = list(title = 'Elevation')))

```
